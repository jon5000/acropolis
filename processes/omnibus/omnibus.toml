# Top-level configuration for Acropolis omnibus process

# ============================================================================
# Startup Configuration
# ============================================================================
[global.startup]
method = "mithril"  # Options: "mithril" | "snapshot"
topic = "cardano.sequence.start"

# ============================================================================
# Bootstrap Module Configurations
# ============================================================================
[module.genesis-bootstrapper]

[module.mithril-snapshot-fetcher]
aggregator-url = "https://aggregator.release-mainnet.api.mithril.network/aggregator"
genesis-key = "5b3139312c36362c3134302c3138352c3133382c31312c3233372c3230372c3235302c3134342c32372c322c3138382c33302c31322c38312c3135352c3230342c31302c3137392c37352c32332c3133382c3139362c3231372c352c31342c32302c35372c37392c33392c3137365d"
# Download max age in hours. E.g. 8 means 8 hours (if there isn't any snapshot within this time range download from Mithril)
download-max-age = "never"
# Pause constraint E.g. "epoch:100", "block:1200"
pause = "none"

[module.snapshot-bootstrapper]
epoch = 509
network = "mainnet"
data-dir = "../../modules/snapshot_bootstrapper/data"

# ============================================================================
# Core Module Configurations
# ============================================================================
[module.peer-network-interface]
sync-point = "snapshot"
node-addresses = [
    "backbone.cardano.iog.io:3001",
    "backbone.mainnet.cardanofoundation.org:3001",
    "backbone.mainnet.emurgornd.com:3001",
]
magic-number = 764824073

[module.consensus]
# List of validation result topics to listen on
validators = [
# Add these once they are actually being sent
#           "cardano.validation.vrf",
#           "cardano.validation.kes",
#           "cardano.validation.utxo"
]

[module.block-unpacker]

[module.rest-blockfrost]

[module.tx-unpacker]
publish-utxo-deltas-topic = "cardano.utxo.deltas"
publish-asset-deltas-topic = "cardano.asset.deltas"
publish-withdrawals-topic = "cardano.withdrawals"
publish-certificates-topic = "cardano.certificates"
publish-governance-topic = "cardano.governance"
publish-block-txs-topic = "cardano.block.txs"
publish-tx-validation-topic = "cardano.validation.txs"
network-name = "mainnet"

[module.utxo-state]
store = "memory" # "memory", "dashmap", "fjall", "fjall-async", "sled", "sled-async", "fake"
address-delta-topic = "cardano.address.delta"

[module.spo-state]
# Enables /pools/{pool_id}/history endpoint, enables to query active_stakes
store-epochs-history = false
# Enable /pools/retired
store-retired-pools = false
# Enables /pools/{pool_id} endpoint
store-registration = false
# # Enables /pools/{pool_id}/updates endpoint
store-updates = false
# Enables /pools/{pool_id}/delegators endpoint (Requires store-stake-addresses to be enabled)
store-delegators = false
# Enables /pools/{pool_id}/votes endpoint
store-votes = false
# Store blocks, enables /pools/{pool_id}/blocks, /epochs/{number}/blocks/{pool_id}
store-blocks = false
# Store stake_addresses
store-stake-addresses = false

[module.spdd-state]
# Enables active_stakes in /epochs/latest | {number} endpoints
store-spdd = false

[module.historical-accounts-state]
# Clear state on start up (default true)
clear-on-start = true
# Enables /accounts/{stake_address}/rewards endpoint
store-rewards-history = false
# Enables /accounts/{stake_address}/history endpoint
store-active-stake-history = false
# Enables /accounts/{stake_address}/registrations endpoint
store-registration-history = false
# Enables /accounts/{stake_address}/delegations endpoint
store-delegation-history = false
# Enables /accounts/{stake_address}/mirs endpoint
store-mir-history = false
# Enables /accounts/{stake_address}/withdrawals endpoint
store-withdrawal-history = false
# Enables /accounts/{stake_address}/addresses endpoint
store-addresses = false
# Enables /accounts/{stake_address}/addresses/total endpoint (Requires store-addresses to be enabled)
store-tx-count = false

[module.historical-epochs-state]
# Clear state on start up (default true)
clear-on-start = true

[module.drep-state]
# Enables /governance/dreps/{drep_id} endpoint (Requires store-delegators to be enabled)
store-info = false
# Enables /governance/dreps/{drep_id}/delegators endpoint
store-delegators = false
# Enables /governance/dreps/{drep_id}/metadata endpoint
store-metadata = false
# Enables /governance/dreps/{drep_id}/updates endpoint
store-updates = false
# Enables /governance/dreps/{drep_id}/votes endpoint
store-votes = false

[module.drdd-state]
store-drdd = false

[module.governance-state]

[module.parameters-state]
store-history = false

[module.stake-delta-filter]
cache-mode = "predefined" # "predefined", "read", "write", "write-if-absent"
write-full-cache = "false"

[module.epochs-state]

[module.accounts-state]
# Enable /epochs/{number}/stakes & /epochs/{number}/stakes/{pool_id} endpoints
spdd-retention-epochs = 0
spdd-db-path = "./fjall-spdd"
spdd-clear-on-start = true
# Verify against captured CSV
verify-pots-file = "../../modules/accounts_state/test-data/pots.mainnet.csv"
verify-rewards-files = "../../modules/accounts_state/test-data/rewards.mainnet.{}.csv"
verify-spdd-files = "../../modules/accounts_state/test-data/spdd.mainnet.{}.csv"

[module.assets-state]
# Enables /assets endpoint
store-assets = false
# Enables /assets/{asset} endpoint (requires store-assets to be enabled)
store-info = false
# Enables /assets/{asset}/history endpoint
store-history = false
# Enables /assets/{asset}/transactions endpoint
#   Usage: "none", "all", or most recent: "1", "20", etc.
store-transactions = "none"
# Enables /assets/{asset}/addresses endpoint
store-addresses = false
# Enables /assets/{asset} endpoint (requires store-assets to be enabled)
index-by-policy = false

[module.chain-store]
# Clear state on start up (default true)
clear-on-start = true

[module.address-state]
# Clear state on start up (default true)
clear-on-start = true
# Enables /addresses/{address}, /addresses/{address}/extended,
# /addresses/{address}/utxos/{asset}, and /addresses/{address}/utxos endpoints
store-info = false
# Enables /addresses/{address}/totals endpoint
store-totals = false
# Enables /addresses/{address}/transactions endpoint
store-transactions = false

[module.block-vrf-validator]

[module.block-kes-validator]

[module.clock]

[module.rest-server]
address = "127.0.0.1"
port = 4340

[module.spy]
# Enable for message spying
#topic = "cardano.#"

# ============================================================================
# Message Bus Configuration
# ============================================================================
[message-bus.external]
class = "rabbit-mq"
url = "amqp://127.0.0.1:5672/%2f"
exchange = "caryatid"

[message-bus.internal]
class = "in-memory"
workers = 50
dispatch-queue-size = 1000
worker-queue-size = 100
bulk-block-capacity = 50
bulk-resume-capacity = 75

# Message routing
[[message-router.route]]  # Everything is internal only
pattern = "#"
bus = "internal"
